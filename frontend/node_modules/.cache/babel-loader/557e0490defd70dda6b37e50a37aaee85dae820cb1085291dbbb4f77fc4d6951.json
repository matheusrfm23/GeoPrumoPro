{"ast":null,"code":"// geoprumo/frontend/src/components/MapView/MapView.jsx\nimport React,{useEffect}from'react';import{MapContainer,TileLayer,Marker,Popup,GeoJSON,useMap}from'react-leaflet';import'leaflet/dist/leaflet.css';import L from'leaflet';// --- Correção para o ícone padrão do marcador ---\nimport icon from'leaflet/dist/images/marker-icon.png';import iconShadow from'leaflet/dist/images/marker-shadow.png';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";let DefaultIcon=L.icon({iconUrl:icon,shadowUrl:iconShadow,iconAnchor:[12,41]});L.Marker.prototype.options.icon=DefaultIcon;// --- Fim da correção ---\nconst FitBounds=_ref=>{let{route}=_ref;const map=useMap();useEffect(()=>{if(route&&route.length>0){const activePoints=route.filter(p=>p.active!==false);if(activePoints.length>0){const bounds=L.latLngBounds(activePoints.map(p=>[p.latitude,p.longitude]));map.fitBounds(bounds,{padding:[50,50]});}}},[route,map]);return null;};function MapView(_ref2){let{data}=_ref2;const defaultPosition=[-19.9167,-43.9333];const routePoints=data===null||data===void 0?void 0:data.optimized_route;const routeGeoJson=data===null||data===void 0?void 0:data.map_geojson;// CORREÇÃO: Adicionamos uma 'key' ao MapContainer.\n// Isso força o mapa a recarregar completamente quando a rota muda, limpando traçados antigos.\nconst mapKey=JSON.stringify(routeGeoJson);return/*#__PURE__*/_jsxs(MapContainer,{center:defaultPosition,zoom:13,style:{height:'100%',width:'100%',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\"}),routePoints&&routePoints.filter(p=>p.active!==false).map(point=>/*#__PURE__*/_jsx(Marker,{position:[point.latitude,point.longitude],children:/*#__PURE__*/_jsxs(Popup,{children:[/*#__PURE__*/_jsxs(\"b\",{children:[point.order,\": \",point.name]}),/*#__PURE__*/_jsx(\"br\",{}),\"Lat: \",point.latitude.toFixed(5),\", Lon: \",point.longitude.toFixed(5)]})},point.order)),routeGeoJson&&/*#__PURE__*/_jsx(GeoJSON,{data:routeGeoJson,style:{color:'#007BFF',weight:5,opacity:0.8}}),/*#__PURE__*/_jsx(FitBounds,{route:routePoints})]},mapKey);}export default MapView;","map":{"version":3,"names":["React","useEffect","MapContainer","TileLayer","Marker","Popup","GeoJSON","useMap","L","icon","iconShadow","jsx","_jsx","jsxs","_jsxs","DefaultIcon","iconUrl","shadowUrl","iconAnchor","prototype","options","FitBounds","_ref","route","map","length","activePoints","filter","p","active","bounds","latLngBounds","latitude","longitude","fitBounds","padding","MapView","_ref2","data","defaultPosition","routePoints","optimized_route","routeGeoJson","map_geojson","mapKey","JSON","stringify","center","zoom","style","height","width","borderRadius","children","url","attribution","point","position","order","name","toFixed","color","weight","opacity"],"sources":["C:/Users/mathe/Desktop/GeoPrumoPro/frontend/src/components/MapView/MapView.jsx"],"sourcesContent":["// geoprumo/frontend/src/components/MapView/MapView.jsx\r\n\r\nimport React, { useEffect } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup, GeoJSON, useMap } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport L from 'leaflet';\r\n\r\n// --- Correção para o ícone padrão do marcador ---\r\nimport icon from 'leaflet/dist/images/marker-icon.png';\r\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nlet DefaultIcon = L.icon({\r\n    iconUrl: icon,\r\n    shadowUrl: iconShadow,\r\n    iconAnchor: [12, 41] \r\n});\r\nL.Marker.prototype.options.icon = DefaultIcon;\r\n// --- Fim da correção ---\r\n\r\nconst FitBounds = ({ route }) => {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (route && route.length > 0) {\r\n      const activePoints = route.filter(p => p.active !== false);\r\n      if (activePoints.length > 0) {\r\n        const bounds = L.latLngBounds(activePoints.map(p => [p.latitude, p.longitude]));\r\n        map.fitBounds(bounds, { padding: [50, 50] });\r\n      }\r\n    }\r\n  }, [route, map]);\r\n  return null;\r\n};\r\n\r\nfunction MapView({ data }) {\r\n  const defaultPosition = [-19.9167, -43.9333];\r\n\r\n  const routePoints = data?.optimized_route;\r\n  const routeGeoJson = data?.map_geojson;\r\n\r\n  // CORREÇÃO: Adicionamos uma 'key' ao MapContainer.\r\n  // Isso força o mapa a recarregar completamente quando a rota muda, limpando traçados antigos.\r\n  const mapKey = JSON.stringify(routeGeoJson);\r\n\r\n  return (\r\n    <MapContainer key={mapKey} center={defaultPosition} zoom={13} style={{ height: '100%', width: '100%', borderRadius: '8px' }}>\r\n      <TileLayer\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n      />\r\n\r\n      {/* Renderiza apenas os marcadores ativos */}\r\n      {routePoints && routePoints.filter(p => p.active !== false).map(point => (\r\n        <Marker key={point.order} position={[point.latitude, point.longitude]}>\r\n          <Popup>\r\n            <b>{point.order}: {point.name}</b><br />\r\n            Lat: {point.latitude.toFixed(5)}, Lon: {point.longitude.toFixed(5)}\r\n          </Popup>\r\n        </Marker>\r\n      ))}\r\n\r\n      {routeGeoJson && (\r\n        <GeoJSON data={routeGeoJson} style={{ color: '#007BFF', weight: 5, opacity: 0.8 }} />\r\n      )}\r\n      \r\n      <FitBounds route={routePoints} />\r\n    </MapContainer>\r\n  );\r\n}\r\n\r\nexport default MapView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}